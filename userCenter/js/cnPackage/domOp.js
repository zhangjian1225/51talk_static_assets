"use strict";define("cnPackage/domOp",["cnPackage/buildClass","cnPackage/getPeriod","../common/layer"],function(i,t,e){window.dateList=[],window.timeObj={},window.timeList=[],window.inited=!1,window.date_index=0,window.time_index=0,window.date_list_index=-1,window.time_list_index=-1,window.alert_text="",window.wierd=!1,window.doubleDivision={noData:!1};var a=i("json2"),o=i("../common/layer"),n=i("cnPackage/buildClass"),l=i("cnPackage/getPeriod");$("#buyBtn").addClass("hide");new function(){var s=this;this.selDate=$("#js_date"),this.selTime=$("#js_time"),this.date_list=$("#js_date_list"),this.time_list=$("#js_time_list"),this.date_title=$("#js_date_title"),this.time_title=$("#js_time_title"),this.items=$(".item"),this.buy=$("#buyBtn"),this.dis_buy=$("#disBuy"),this.box=$("#cn-box"),this.courseList=$("#courseInfo"),this.courseList.on("click","li",function(){if($(".li-spec").removeClass("active"),$("#cn-box").hide(),$("#holiday").hide(),$("#js_date_title").text("\u8bf7\u9009\u62e9\u5f00\u59cb\u4e0a\u8bfe\u7684\u65e5\u671f"),window.date_list_index=-1,window.time_list_index=-1,window.date_index=0,window.time_index=0,$(this).addClass("active"),$(this).attr("id")){var i={from:"web",point_type:"mix_point",id:$(this).attr("id")},t={mix_id:$(this).attr("id")};l.getPrice(i),l.getDateList(t)}}),this.addEvent=function(){$(document).click(function(){s.date_list.hide(),s.time_list.hide()}),this.selDate.click(function(){if(!$(this).hasClass("disable"))return s.date_list.show(),!1;o.showFn(window.alert_text)}),this.selTime.click(function(){if(!$(this).hasClass("disable"))return s.time_list.show(),!1}),this.date_list.on("click","li",function(){$("#holiday").hide();var i=$(this).text(),t=$(this).index();window.date_list_index=t,window.inited=!1,s.date_title.text(i),s.date_list.hide(),s.box.show(),n.resetTime(),l.getTimeList(dateList[t])}),this.time_list.on("click","li",function(){var i=$(this).index(),t=$(this).html();window.time_list_index=i,s.time_title.text(t),s.time_list.hide();var e=$(this).data("holi");e?($("#holiday").show(),$(".holi").text(e)):$("#holiday").hide()}),this.items.click(function(){if($("#holiday").hide(),!$(this).hasClass("active")&&!window.wierd){window.time_list_index=-1,$(this).addClass("active").siblings().removeClass("active");var i=$(this).index();$(this).parent().hasClass("js_date_tab")?window.date_index=i:window.time_index=i,n.selItems(date_index,time_index)}}),this.buy.click(function(){var i=dateList[date_list_index],t=timeList[time_list_index];if(doubleDivision.noData)return o.showFn("\u8bf7\u5148\u8054\u7cfb\u60a8\u7684\u8bfe\u7a0b\u987e\u95ee\uff0c\u5b8c\u6210\u4e2d\u6559\u4f53\u9a8c\u8bfe\uff0c\u624d\u80fd\u8d2d\u4e70\u5408\u9002\u7684\u7ea7\u522b\u8bfe\u7a0b"),!1;if(dateList&&timeList&&i&&t){var e=t.key,s=a.stringify(timeObj.map[e]),n=$.extend(!0,{},i,t),d={point_type:"mix_point",cart:a.stringify({mix:n}),sub_map:s};l.checkCart(d)}else window.wierd?o.showFn("\u8bf7\u5237\u65b0\u5217\u8868\uff0c\u91cd\u65b0\u9009\u62e9\uff01"):o.showFn("\u8bf7\u9009\u62e9\u4e0a\u8bfe\u65f6\u95f4\uff01")}),this.dis_buy.click(function(){o.showFn(window.alert_text)})},this.init=function(){this.getAjax(),this.addEvent()},this.getAjax=function(){var s=setInterval(function(){var i=$("#tabBox").attr("data-id");if(i){clearInterval(s);var t={from:"web",point_type:"mix_point",id:i},e={mix_id:i};l.getCourseList({from:"web",point_type:"mix_point"}),l.getPrice(t),l.getDateList(e)}},500)},this.init()}});