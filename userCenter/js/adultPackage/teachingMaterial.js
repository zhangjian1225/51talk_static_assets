"use strict";define("adultPackage/teachingMaterial",["tpl/adultPackage/index.js","tplCommon","../common/cart","../common/banner","../common/timeout","../common/packageTab","../common/detailInfo","../common/layer","../common/util","../common/backTop"],function(t,a,e){var i=t("tpl/adultPackage/index.js");$("#teachingMaterial").html(i.teaching_material_main());var r=t("tplCommon"),c=t("../common/cart");$("#cartBox").html(r.cartBox());var n=t("../common/util");n.renderHeaderBottom(),n.replaceImgUrl("#teachingMaterial",static_url),t("../common/banner");var o=t("../common/timeout");o.ajaxApiParams="book",new o.timeout,t("../common/packageTab"),t("../common/backTop"),setTimeout(function(){t("../common/detailInfo")},1e3);var s=t("../common/layer"),d=t("json2"),h=t("cookie");(function(){$.ajax({url:window.href_url+"/api/bookList",type:"get",dataType:"json",success:function(t){1==t.status?($("#teacingCourse").html(i.teaching_course(t)),n.replaceImgUrl("#teacingCourse",static_url),l()):alert(t.info)}})})();var l=function(){({tabId:$("#tabId"),courseInfo:$("#courseInfo"),courseBox:$("._course-box"),suspensionInfo:$(".suspension-info"),priceId:$("#priceId"),coursePrice:0,priceBox:$("#priceBox"),cart:[],purchaseImmediately:$("#purchaseImmediately"),materialUl:$("#materialUl"),prevId:$("._prev"),nextId:$("._next"),layerId:$("._layer"),textbookMask:$("#textbookMask"),closeId:$("#closeId"),cartObj:{},cartBtn:$("#cartBtn"),_event:function(){var a=this;this.courseInfo.find("li").not(".n-chose").on("click",function(){a.cur=$(this),a.dataPrice=a.cur.attr("data-price"),a.title=a.cur.find("p").text(),a.cartId=a.cur.attr("data-id"),a.cur.hasClass("chose")?(a.choseNum=a.courseInfo.find(".chose").size(),a.cur.removeClass("chose"),a.reducePrice(a.dataPrice,a.cartId)):(a.cur.addClass("chose"),a.addPrice(a.dataPrice,a.cartId))}),this.purchaseImmediately.on("click",function(){0==a.courseInfo.find(".chose").size()?s.showFn("\u60a8\u8fd8\u672a\u9009\u8d2d\u4efb\u4f55\u8bfe\u7a0b\u5546\u54c1\u54e6"):(a.dataCart=d.stringify({cart:a.cart}),$.ajax({url:window.href_url+"/ajax/checkCart",type:"get",dataType:"json",async:!1,data:{cart:a.dataCart},success:function(t){1==t.status?($("#formCard").val(a.dataCart),$("#buyBtnFrom").submit()):0==t.status&&s.showFn(t.info)}}))}),this.materialUl.find("li .li-img").hover(function(){$(this).find("._layer").show()},function(){$(this).find("._layer").hide()}),$(".btn-box").find("a").on("click",function(){$(this).hasClass("current")||a.changeFn($(this))}),this.layerId.find("a").on("click",function(){return a.textbookMask.show(),$("#pdf").attr("src",$(this).attr("href")),!1}),this.textbookMask.height($(document).height()),this.closeId.on("click",function(){a.textbookMask.hide()}),this.materialUl.find("li").each(function(t){$(this).find("._layer a").attr("href",$(this).find(".btn-box a").eq(0).attr("pdf-url"))}),this.cartBtn.on("click",function(){0==a.courseInfo.find(".chose").size()&&s.showFn("\u60a8\u8fd8\u672a\u9009\u8d2d\u4efb\u4f55\u8bfe\u7a0b\u5546\u54c1\u54e6")}),c.init(),c.addEvent()},changeFn:function(t){var a=t.index()+1;t.parent().find("a").removeClass("current"),t.addClass("current"),t.parents("li").find("._c-title").text("Book"+a).end().find("._layer a").attr("href",t.attr("pdf-url"))},addPrice:function(){this.coursePrice+=parseInt(this.dataPrice),this.priceId.text(this.coursePrice),this.cart.push(this.cartId),this.priceBox.show();var t=this.cartId;this.cartObj[t]={id:this.cartId,price:this.dataPrice,title:this.title,point_type:$("#point_type").val(),point_value:"",expire_days:"",is_show_installment:"",installment_num:"",installment_price:""},this.cartBtn.attr("data-cart",d.stringify(this.cartObj)),this.isCanBuy()},reducePrice:function(){1==this.choseNum&&this.priceBox.hide(),this.coursePrice-=parseInt(this.dataPrice),this.priceId.text(this.coursePrice),this.cart.pop(this.cartId),delete this.cartObj[this.cartId],this.cartBtn.attr("data-cart",d.stringify(this.cartObj)),this.isCanBuy()},isCanBuy:function(){var t=_.keys(this.cartObj).length,a=d.parse(h.getCookie("cart")).goods;a=a||{};var e=0;for(var i in this.cartObj)a[i]&&e++;t==e&&0!=t&&0!=e?($(".jsCart").text("\u5df2\u52a0\u5165\u8d2d\u7269\u8f66"),$(".jsCart").addClass("already-cart")):($(".jsCart").text("\u52a0\u5165\u8d2d\u7269\u8f66"),$(".jsCart").removeClass("already-cart"))}})._event()}});